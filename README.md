# UHFReader288Demo - Enhanced EPC Access Control System

## 📋 项目概述

UHFReader288Demo是一个基于Windows Forms的UHF RFID标签读取和门禁管理应用程序，集成了完整的EPC标签追踪、服务器同步和组装件ID管理功能。

## 🆕 最新更新 (v6.1)

### 新增功能

- **🏷️ EPC组装件ID查询**: 实时查询服务器中EPC标签对应的组装件ID
- **🔄 服务器数据同步**: 与API v3.6.6完全兼容的数据上传和查询
- **📊 增强的UI显示**: 新增组装件ID列，支持实时更新
- **🛠️ 调试工具**: 内置API诊断和查询测试功能
- **💾 智能缓存**: EPC组装件ID本地缓存，避免重复查询

### API集成

- **服务器**: `http://175.24.178.44:8082`
- **API版本**: v3.6.6
- **认证**: HTTP Basic Authentication
- **支持功能**: 
  - EPC记录创建和查询
  - 动态状态配置同步
  - 组装件ID检索
  - Dashboard统计数据

## 🎯 核心功能

### 1. EPC门禁管理
- **双天线检测**: 天线1和天线8协同工作
- **进出方向判断**: 自动识别进入/离开方向
- **状态追踪**: 实时显示检测中、进入、离开状态
- **高亮显示**: 检测中的记录黄色高亮显示

### 2. 组装件ID集成
- **自动查询**: 检测到新EPC时自动查询对应的组装件ID
- **持久显示**: 一旦查询到ID就固定显示，不受状态变更影响
- **智能缓存**: 避免重复API调用，提升响应速度
- **导出支持**: CSV导出包含完整的组装件ID信息

### 3. 服务器同步
- **实时上传**: 每次完整的进出动作立即上传到服务器
- **状态配置**: 从服务器动态获取操作状态选项
- **错误处理**: 完善的网络异常和超时处理
- **调试工具**: 内置API连接测试和查询诊断

## 🖥️ 用户界面

### 主要控件
| 控件 | 功能 | 描述 |
|------|------|------|
| **数据表格** | 记录显示 | 显示EPC、方向、时间、状态、设备、组装件ID |
| **开始/停止监控** | 控制检测 | 启动或停止EPC标签检测 |
| **设备名称** | 设备标识 | 设置当前设备的名称标识 |
| **状态选择** | 状态配置 | 进入和离开时的状态选择 |
| **功率设置** | 硬件控制 | RFID读取器功率调整 |
| **调试工具** | 测试功能 | API诊断和查询测试 |

### 新增调试功能
- **API诊断**: 测试服务器连接和数据结构
- **测试查询ID**: 对特定EPC进行组装件ID查询测试
- **检测中状态**: 显示当前待处理的检测记录

## 🚀 使用方法

### 1. 启动应用
```bash
# 使用构建脚本
.\build.bat Release x86
.\bin\x86\Release\UHFReader288Demo.exe

# 或者直接运行
UHFReader288Demo.exe
```

### 2. 门禁监控流程
1. **设置设备名称**: 输入设备标识符
2. **选择状态**: 配置进入和离开时的状态
3. **点击"开始监控"**: 启动EPC检测
4. **标签检测**: 系统自动检测进出并查询组装件ID
5. **查看记录**: 在数据表格中查看完整信息

### 3. 服务器集成
1. **状态同步**: 点击"刷新状态配置"获取最新状态选项
2. **API诊断**: 使用调试工具验证服务器连接
3. **数据导出**: 导出包含组装件ID的完整记录

## 🔧 技术架构

### 开发环境
- **框架**: .NET Framework 4.8
- **语言**: C# (Windows Forms)
- **HTTP客户端**: System.Net.Http
- **JSON处理**: System.Web.Script.Serialization

### 数据流程
```
EPC检测 → 状态判断 → 组装件ID查询 → UI更新 → 服务器上传
    ↓
本地缓存 ← API查询 ← 服务器数据库
```

### API集成
- **查询端点**: `GET /api/epc-records?epcId={EPC}&limit=50`
- **上传端点**: `POST /api/epc-record`
- **状态配置**: `GET /api/status-config`
- **健康检查**: `GET /health`

## 📁 项目结构

```
UHFReader288Demo/
├── EPCAccessControlForm.cs          # 主要门禁管理窗体
├── EPCAccessControlIntegration.cs   # 门禁集成类
├── Form1.cs                         # 主应用程序窗体
├── DeviceClass.cs                   # 设备管理类
├── build.bat / build.ps1           # 构建脚本
├── API_README_V366.md               # API文档
└── bin/                             # 构建输出目录
```

## 🐛 故障排除

### 常见问题

1. **组装件ID显示"未找到"**:
   - 使用"API诊断"检查服务器连接
   - 确认数据库中存在该EPC的记录
   - 查看Debug输出窗口的详细日志

2. **服务器连接失败**:
   - 检查网络连接
   - 确认服务器地址: `http://175.24.178.44:8082`
   - 验证认证信息是否正确

3. **EPC检测异常**:
   - 确认硬件连接正常
   - 检查天线1和天线8状态
   - 调整RFID读取器功率设置

### 调试工具使用

1. **API诊断**:
   - 点击"API诊断"按钮
   - 查看Debug输出窗口
   - 确认健康检查和数据查询结果

2. **查询测试**:
   - 确保有EPC记录存在
   - 点击"测试查询ID"
   - 观察完整的查询过程日志

## 📊 构建信息

### 构建状态
- **Status**: ✅ 成功
- **Target Framework**: .NET Framework 4.8
- **支持平台**: x86, x64, AnyCPU

### 构建命令
```cmd
# 快速构建
.\build.bat Debug AnyCPU

# Release构建
.\build.bat Release x86
```

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📄 许可证

此项目基于标准软件许可证分发。

## 📞 技术支持

- **健康检查**: http://175.24.178.44:8082/health
- **API文档**: 查看 `API_README_V366.md`
- **问题反馈**: 请提交到项目Issue页面

---

**版本**: v6.1  
**最后更新**: 2025-01-20  
**兼容性**: API v3.6.6  
**状态**: 生产就绪